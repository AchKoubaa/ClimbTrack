<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:ClimbTrack.ViewModels"
             x:Class="ClimbTrack.Views.EditProfilePage"
             x:DataType="viewmodels:EditProfileViewModel"
             Title="{Binding Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="FormLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="TextColor" Value="{StaticResource TextSecondaryColor}" />
                <Setter Property="Margin" Value="0,10,0,5" />
            </Style>

            <Style x:Key="FormEntryStyle" TargetType="Entry">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="TextColor" Value="{StaticResource TextPrimaryColor}" />
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="Margin" Value="0,0,0,15" />
            </Style>

            <Style x:Key="FormEditorStyle" TargetType="Editor">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="TextColor" Value="{StaticResource TextPrimaryColor}" />
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="Margin" Value="0,0,0,15" />
                <Setter Property="AutoSize" Value="TextChanges" />
            </Style>

            <Style x:Key="ActionButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="{StaticResource PrimaryColor}" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="FontSize" Value="16" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="CornerRadius" Value="25" />
                <Setter Property="Padding" Value="24,12" />
                <Setter Property="HorizontalOptions" Value="Fill" />
                <Setter Property="Margin" Value="0,10,0,0" />
            </Style>

            <Style x:Key="CancelButtonStyle" TargetType="Button">
                <Setter Property="BackgroundColor" Value="Transparent" />
                <Setter Property="TextColor" Value="{StaticResource PrimaryColor}" />
                <Setter Property="FontSize" Value="16" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="BorderColor" Value="{StaticResource PrimaryColor}" />
                <Setter Property="BorderWidth" Value="1" />
                <Setter Property="CornerRadius" Value="25" />
                <Setter Property="Padding" Value="24,12" />
                <Setter Property="HorizontalOptions" Value="Fill" />
                <Setter Property="Margin" Value="0,10,0,0" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <ScrollView>
        <StackLayout Padding="20">
            <Label Text="Nome Visualizzato" 
                   Style="{StaticResource FormLabelStyle}"
                   AutomationProperties.Name="Etichetta Nome Visualizzato" />
            <Entry Text="{Binding UserProfile.DisplayName}" 
                   Style="{StaticResource FormEntryStyle}"
                   AutomationProperties.Name="Nome Visualizzato"
                   AutomationProperties.HelpText="Inserisci il tuo nome visualizzato" />

            <Label Text="Email" 
                   Style="{StaticResource FormLabelStyle}"
                   AutomationProperties.Name="Etichetta Email" />
            <Entry Text="{Binding UserProfile.Email}" 
                   IsEnabled="False" 
                   Style="{StaticResource FormEntryStyle}"
                   AutomationProperties.Name="Email"
                   AutomationProperties.HelpText="La tua email non puÃ² essere modificata" />

            <Label Text="URL Foto Profilo" 
                   Style="{StaticResource FormLabelStyle}"
                   AutomationProperties.Name="Etichetta URL Foto Profilo" />
            <Entry Text="{Binding UserProfile.PhotoUrl}" 
                   Style="{StaticResource FormEntryStyle}"
                   AutomationProperties.Name="URL Foto Profilo"
                   AutomationProperties.HelpText="Inserisci l'URL della tua foto profilo" />

            <Label Text="Bio" 
                   Style="{StaticResource FormLabelStyle}"
                   AutomationProperties.Name="Etichetta Bio" />
            <Editor Text="{Binding UserProfile.Bio}" 
                    Style="{StaticResource FormEditorStyle}" 
                    HeightRequest="100"
                    AutomationProperties.Name="Bio"
                    AutomationProperties.HelpText="Inserisci una breve biografia" />

            <Label Text="Palestra Preferita" 
                   Style="{StaticResource FormLabelStyle}"
                   AutomationProperties.Name="Etichetta Palestra Preferita" />
            <Entry Text="{Binding UserProfile.PreferredGym}" 
                   Style="{StaticResource FormEntryStyle}"
                   AutomationProperties.Name="Palestra Preferita"
                   AutomationProperties.HelpText="Inserisci il nome della tua palestra preferita" />

            <!-- Indicatore di caricamento -->
            <ActivityIndicator IsRunning="{Binding IsBusy}" 
                               IsVisible="{Binding IsBusy}"
                               Color="{StaticResource PrimaryColor}"
                               HorizontalOptions="Center"
                               Margin="0,10,0,10"
                               AutomationProperties.Name="Caricamento in corso"
                               AutomationProperties.IsInAccessibleTree="{Binding IsBusy}" />

            <Button Text="Salva Modifiche" 
                    Command="{Binding SaveCommand}" 
                    Style="{StaticResource ActionButtonStyle}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBoolConverter}}"
                    AutomationProperties.Name="Salva Modifiche"
                    AutomationProperties.HelpText="Premi per salvare le modifiche al profilo" />

            <Button Text="Annulla" 
                    Command="{Binding CancelCommand}" 
                    Style="{StaticResource CancelButtonStyle}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InverseBoolConverter}}"
                    AutomationProperties.Name="Annulla"
                    AutomationProperties.HelpText="Premi per annullare le modifiche e tornare indietro" />
        </StackLayout>
    </ScrollView>
</ContentPage>