<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:ClimbTrack.ViewModels"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="ClimbTrack.Views.EditProfilePage"
             x:DataType="viewmodels:EditProfileViewModel"
             Title="{Binding Title}">

    <ContentPage.Resources>
        <toolkit:InvertedBoolConverter x:Key="InvertedBoolConverter" />
    </ContentPage.Resources>

    <ScrollView>
        <StackLayout Padding="20">
            <!-- Profile Image Section -->
            <StackLayout Orientation="Vertical" Spacing="10">
                <Frame CornerRadius="75" HeightRequest="150" WidthRequest="150" 
                       Padding="0" IsClippedToBounds="True" 
                       HorizontalOptions="Center" BorderColor="{StaticResource PrimaryColor}">
                    <Grid>
                        <!-- Default image or initials when no photo is available -->
                        <StackLayout IsVisible="{Binding UserProfile.HasPhoto, Converter={StaticResource InvertedBoolConverter}}"
                                    BackgroundColor="{StaticResource PrimaryColor}"
                                    HorizontalOptions="Fill"
                                    VerticalOptions="Fill">
                            <Label Text="{Binding UserProfile.Initials}"
                                   TextColor="White"
                                   FontSize="48"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"
                                   />
                        </StackLayout>

                        <!-- Selected profile image -->
                        <Image Source="{Binding UserProfile.PhotoUrl}"
                               IsVisible="{Binding UserProfile.HasPhoto}"
                               Aspect="AspectFill"
                               HeightRequest="150" WidthRequest="150"
                               />
                    </Grid>
                </Frame>

                <Button Text="Seleziona Foto" 
                        Command="{Binding PickPhotoCommand}"
                        Style="{StaticResource SecondaryButtonStyle}"
                        HorizontalOptions="Center"
                        IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                       
                        />
            </StackLayout>

            <!-- Rest of your form fields -->
            <Label Text="Nome Visualizzato" 
                   Style="{StaticResource FormLabelStyle}"
                   />
            <Entry Text="{Binding UserProfile.DisplayName}" 
                   Style="{StaticResource FormEntryStyle}"
                  
                   />

            <Label Text="Email" 
                   Style="{StaticResource FormLabelStyle}"
                   />
            <Entry Text="{Binding UserProfile.Email}" 
                   IsEnabled="False" 
                   Style="{StaticResource FormEntryStyle}"
                  
                   />

            <Label Text="Bio" 
                   Style="{StaticResource FormLabelStyle}"
                   />
            <Editor Text="{Binding UserProfile.Bio}" 
                    Style="{StaticResource FormEditorStyle}" 
                    HeightRequest="100"
                   
                    />

            <Label Text="Palestra Preferita" 
                   Style="{StaticResource FormLabelStyle}"
                   />
            <Entry Text="{Binding UserProfile.PreferredGym}" 
                   Style="{StaticResource FormEntryStyle}"
                  
                   />

            <!-- Indicatore di caricamento -->
            <ActivityIndicator IsRunning="{Binding IsBusy}" 
                               IsVisible="{Binding IsBusy}"
                               Color="{StaticResource PrimaryColor}"
                               HorizontalOptions="Center"
                               Margin="0,10,0,10"
                              
                               />

            <Button Text="Salva Modifiche" 
                    Command="{Binding SaveCommand}" 
                    Style="{StaticResource ActionButtonStyle}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                   
                    />

            <Button Text="Annulla" 
                    Command="{Binding CancelCommand}" 
                    Style="{StaticResource CancelButtonStyle}"
                    IsEnabled="{Binding IsBusy, Converter={StaticResource InvertedBoolConverter}}"
                   
                    />
        </StackLayout>
    </ScrollView>
</ContentPage>