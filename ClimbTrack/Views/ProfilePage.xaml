<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:ClimbTrack.ViewModels"
             xmlns:models="clr-namespace:ClimbTrack.Models"
             x:Class="ClimbTrack.Views.ProfilePage"
             x:DataType="viewmodels:ProfileViewModel"
             Title="{Binding Title}">

    <ContentPage.Resources>
        <ResourceDictionary>
            <Style x:Key="ProfileHeaderStyle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource Primary}" />
                <Setter Property="Padding" Value="20" />
                <Setter Property="CornerRadius" Value="0" />
                <Setter Property="HasShadow" Value="False" />
            </Style>

            <Style x:Key="ProfileImageStyle" TargetType="Frame">
                <Setter Property="HeightRequest" Value="100" />
                <Setter Property="WidthRequest" Value="100" />
                <Setter Property="CornerRadius" Value="50" />
                <Setter Property="IsClippedToBounds" Value="True" />
                <Setter Property="Padding" Value="0" />
                <Setter Property="BorderColor" Value="White" />
                <Setter Property="HorizontalOptions" Value="Center" />
            </Style>

            <Style x:Key="ProfileNameStyle" TargetType="Label">
                <Setter Property="FontSize" Value="24" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="HorizontalOptions" Value="Center" />
                <Setter Property="Margin" Value="0,10,0,5" />
            </Style>

            <Style x:Key="ProfileEmailStyle" TargetType="Label">
                <Setter Property="FontSize" Value="16" />
                <Setter Property="TextColor" Value="White" />
                <Setter Property="HorizontalOptions" Value="Center" />
                <Setter Property="Opacity" Value="0.8" />
            </Style>

            <Style x:Key="StatCardStyle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource BackgroundColor}" />
                <Setter Property="CornerRadius" Value="10" />
                <Setter Property="HasShadow" Value="True" />
                <Setter Property="Padding" Value="15" />
                <Setter Property="Margin" Value="5" />
            </Style>

            <Style x:Key="StatValueStyle" TargetType="Label">
                <Setter Property="FontSize" Value="24" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource TextPrimaryColor}" />
                <Setter Property="HorizontalOptions" Value="Center" />
            </Style>

            <Style x:Key="StatLabelStyle" TargetType="Label">
                <Setter Property="FontSize" Value="14" />
                <Setter Property="TextColor" Value="{StaticResource TextSecondaryColor}" />
                <Setter Property="HorizontalOptions" Value="Center" />
            </Style>

            <Style x:Key="SectionTitleStyle" TargetType="Label">
                <Setter Property="FontSize" Value="18" />
                <Setter Property="FontAttributes" Value="Bold" />
                <Setter Property="TextColor" Value="{StaticResource TextPrimaryColor}" />
                <Setter Property="Margin" Value="0,15,0,10" />
            </Style>

            <Style x:Key="SessionCardStyle" TargetType="Frame">
                <Setter Property="BackgroundColor" Value="{StaticResource BackgroundColor}" />
                <Setter Property="CornerRadius" Value="10" />
                <Setter Property="HasShadow" Value="True" />
                <Setter Property="Padding" Value="15" />
                <Setter Property="Margin" Value="0,0,0,10" />
            </Style>
        </ResourceDictionary>
    </ContentPage.Resources>

    <RefreshView IsRefreshing="{Binding IsRefreshing}" 
                 Command="{Binding RefreshCommand}"
                 AutomationProperties.Name="Aggiorna profilo"
                 AutomationProperties.HelpText="Trascina verso il basso per aggiornare i dati del profilo">
        <ScrollView>
            <StackLayout Spacing="0">
                <!-- Profile Header -->
                <Frame Style="{StaticResource ProfileHeaderStyle}">
                    <StackLayout Spacing="10">
                        <!-- Profile Image -->
                        <Frame Style="{StaticResource ProfileImageStyle}"
                               AutomationProperties.Name="Immagine profilo">
                            <Grid>
                                <Image 
                                    Source="{Binding UserProfile.PhotoUrl}" 
                                    Aspect="AspectFill"
                                    IsVisible="{Binding UserProfile.HasPhoto}"
                                    AutomationProperties.Name="Foto profilo" />

                                <Label 
                                    Text="{Binding UserProfile.Initials}" 
                                    FontSize="36" 
                                    FontAttributes="Bold" 
                                    TextColor="{StaticResource PrimaryColor}" 
                                    BackgroundColor="White"
                                    HorizontalOptions="Center"
                                    VerticalOptions="Center"
                                    IsVisible="{Binding UserProfile.HasPhoto, Converter={StaticResource InverseBoolConverter}}"
                                    AutomationProperties.Name="Iniziali profilo" />
                            </Grid>
                        </Frame>

                        <!-- Profile Info -->
                        <Label Text="{Binding UserProfile.DisplayName}" 
                               Style="{StaticResource ProfileNameStyle}"
                               AutomationProperties.Name="Nome utente" />
                        <Label Text="{Binding UserProfile.Email}" 
                               Style="{StaticResource ProfileEmailStyle}"
                               AutomationProperties.Name="Email utente" />

                        <!-- Edit Profile Button -->
                        <Button 
                            Text="Modifica Profilo" 
                            Command="{Binding EditProfileCommand}"
                            BackgroundColor="Transparent"
                            TextColor="White"
                            BorderColor="White"
                            BorderWidth="1"
                            CornerRadius="20"
                            Padding="15,8"
                            HorizontalOptions="Center"
                            Margin="0,10,0,0"
                            AutomationProperties.Name="Modifica profilo"
                            AutomationProperties.HelpText="Premi per modificare i dati del tuo profilo" />

                        <!-- Logout Button -->
                        <Button Grid.Row="2" 
                                Text="Logout" 
                                Command="{Binding LogoutCommand}"
                                Style="{StaticResource PrimaryButtonStyle}"
                                BackgroundColor="{StaticResource AccentColor}"
                                HeightRequest="50"
                                Margin="0,20"
                                AutomationProperties.Name="Logout button"
                                AutomationProperties.HelpText="Press to log out from your account"/>

                        <!-- Admin Button -->
                        <Button 
                            Text="Amministrazione"
                            Command="{Binding GoToAdminCommand}"
                            BackgroundColor="{StaticResource PrimaryColor}"
                            TextColor="White"
                            CornerRadius="10"
                            Margin="0,20,0,0"
                            AutomationProperties.Name="Amministrazione"
                            AutomationProperties.HelpText="Accedi alle funzionalitÃ  di amministrazione" />
                    </StackLayout>
                </Frame>

                <!-- View History Button -->
                <Button 
        Text="Visualizza Storico Allenamenti" 
        Command="{Binding ViewHistoryCommand}"
        Style="{StaticResource SecondaryButtonStyle}"
        Margin="0,20,0,0"
        AutomationProperties.Name="Visualizza storico"
        AutomationProperties.HelpText="Visualizza lo storico completo degli allenamenti" />
                
            </StackLayout>
        </ScrollView>
    </RefreshView>
</ContentPage>